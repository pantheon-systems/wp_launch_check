sudo: false
language: php

notifications:
  email:
    on_success: never
    on_failure: change

branches:
  only:
    - master
    - "/^v[[:digit:]]+\\.[[:digit:]]+\\.[[:digit:]]+.*$/"

php:
  - 7.0
  - 5.6

cache:
  - composer
  - "$HOME/.composer/cache"

env:
  global:
  - WP_CLI_BIN_DIR=/tmp/wp-cli-phar

before_script:
  - bash bin/install-package-tests.sh
  - composer install

script: "./vendor/bin/behat --ansi"

before_deploy:
  - bash bin/prepare.sh

deploy:
  provider: releases
  api_key:
    secure: bP2iK6kCYDVMrbwLEl43mZe2L5ZiYi464kowLrqmI+0vOEblHx4+m5as6AraK5jDFttL68gNwIkOyzQxFbKZDkyntu/aMNa2nXLmhg8T8aGzsHJahpuJMdU/q4e1hysMYXsn03hz31zQiU54DNbRXn9D6oD71u9Rf23FRWFET1w=
  file: wp_launch_check.phar
  skip_cleanup: true
  on:
    repo: pantheon-systems/wp_launch_check
    tags: true
